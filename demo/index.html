<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MariaDB Workspace UI - CDN Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="../public/favicon.ico" />
    <link rel="stylesheet" href="https://use.typekit.net/vme5kwy.css" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/editor/editor.main.css"
    />

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
      }
      mariadb-workspace {
        display: block;
        height: 100%;
        padding: 24px;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body style="padding: 24px">
    <!-- Polyfill Node-ish globals that some ESM bundles read -->
    <script>
      window.process ||= { env: { NODE_ENV: 'production' } }
      window.global ||= window
    </script>

    <!-- Load monaco-editor web-worker -->
    <script>
      window.MonacoEnvironment = {
        getWorkerUrl: function (moduleId, label) {
          const base = 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs'
          const workerPath = `${base}/base/worker/workerMain.js`
          // Use a blob to bypass cross-origin restrictions
          return URL.createObjectURL(
            new Blob([`importScripts("${workerPath}");`], { type: 'text/javascript' })
          )
        },
      }
    </script>

    <!-- Load Monaco Editor -->
    <script type="module">
      import * as monaco from 'https://esm.sh/monaco-editor@0.33.0'
      window.monaco = monaco
    </script>

    <!-- Load web component from local dist folder -->
    <script type="module">
      try {
        await import('./dist/index.js')
        console.log('Web component loaded from local dist')
      } catch (error) {
        console.error('Failed to load web component. Did you run "node download-dist.js"?')
        console.error(error)
      }
    </script>

    <p class="text-info mt-4">
      Below button call worksheetService.deleteAll() from mariadb-workspace web component
    </p>
    <button id="delete-all-worksheets">Delete all worksheets</button>
    <button id="add-a-worksheet">Add a worksheet</button>
    <!-- The Web Component -->
    <mariadb-workspace target-id="server_0" native-params="{}" class="pa-6">
      <div class="conn-obj-select" hidden slot="conn-obj-select">
        Host app provide connection items dropdown here
      </div>
    </mariadb-workspace>
    <!-- Example: Access the exposed worksheetService from the host app -->
    <script>
      document.getElementById('delete-all-worksheets').addEventListener('click', () => {
        const workspaceElement = document.querySelector('mariadb-workspace')
        workspaceElement.worksheetService.deleteAll()
      })
      document.getElementById('add-a-worksheet').addEventListener('click', async () => {
        const workspaceElement = document.querySelector('mariadb-workspace')
        await workspaceElement.worksheetService.insertBlank()
      })
    </script>
  </body>
</html>
